<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>rospy官方教程（一） | 记录学习点滴</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">记录学习点滴</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>rospy官方教程（一）</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2019-07-31</div></div></div><article><div class="container post"><p><font size="5">rospy官方教程（一）发布与订阅</font><br>定义msg消息，创建两个简单的rospy节点。”talker”节点发布信息到主题”chatter”，”listener”节点接受和打印信息。<br>一、定义msg消息<br>1.在beginner_tutorials,新建msg消息目录,新建Num.msg文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ roscd beginner_tutorials</span><br><span class="line">$ mkdir msg</span><br><span class="line">$ cd msg</span><br><span class="line">$ touch Num.msg</span><br><span class="line">$ rosed beginner_tutorials Num.msg</span><br></pre></td></tr></table></figure></p>
<p>2.Num.msg文件写入以下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int64 num</span><br></pre></td></tr></table></figure></p>
<p>3.打开文件rosed beginner_tutorials package.xml,增加依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;message_generation&lt;/build_depend&gt;</span><br><span class="line">&lt;run_depend&gt;message_runtime&lt;/run_depend&gt;</span><br></pre></td></tr></table></figure></p>
<p>4.打开文件rosed beginner_tutorials CMakeLists.txt,增加依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Do not just add this line to your CMakeLists.txt, modify the existing line</span><br><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>5.在CMakeLists.txt文件，增加消息文件，取消#，并修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Num.msg</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>6.在CMakeLists.txt文件，增加消息生成包，取消#，并修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>7.在CMakeLists.txt文件，增加依赖包，取消CATKIN_DEPENDS的#，并修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">catkin_package(</span><br><span class="line">#  INCLUDE_DIRS include</span><br><span class="line">#  LIBRARIES beginner_tutorials</span><br><span class="line">   CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line">#  DEPENDS system_lib</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>8.编译代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/catkin_ws</span><br><span class="line">$ catkin_make</span><br></pre></td></tr></table></figure></p>
<p>9.检查服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rosmsg show beginner_tutorials/Num</span><br></pre></td></tr></table></figure></p>
<p>输出：int64 num</p>
<p>二、编写发布器</p>
<p>1.进入之前建立的包beginner_tutorials<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ roscd beginner_tutorials</span><br></pre></td></tr></table></figure></p>
<p>2.建立Python脚本目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir scripts</span><br><span class="line">$ cd scripts</span><br></pre></td></tr></table></figure></p>
<p>3.新建talker.py文件，设置权限为可执行，并输入代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ touch talker.py                #生成文件</span><br><span class="line">$ chmod +x talker.py             #设置可执行</span><br><span class="line">$ rosed beginner_tutorials talker.py #自己输入代码</span><br></pre></td></tr></table></figure></p>
<p>内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"></span><br><span class="line">import rospy</span><br><span class="line">from std_msgs.msg import String</span><br><span class="line"></span><br><span class="line">def talker():</span><br><span class="line">    pub = rospy.Publisher(&apos;chatter&apos;, String, queue_size=10)</span><br><span class="line">    rospy.init_node(&apos;talker&apos;, anonymous=True)</span><br><span class="line">    rate = rospy.Rate(10) # 10hz</span><br><span class="line">    while not rospy.is_shutdown():</span><br><span class="line">        hello_str = &quot;hello world %s&quot; % rospy.get_time()</span><br><span class="line">        rospy.loginfo(hello_str)</span><br><span class="line">        pub.publish(hello_str)</span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    try:</span><br><span class="line">        talker()</span><br><span class="line">    except rospy.ROSInterruptException:</span><br><span class="line">pass</span><br></pre></td></tr></table></figure></p>
<p>4.代码解析<br>代码：#!/usr/bin/env python<br>分析：指定通过python解释代码<br>代码：import rospy<br>分析：导入rospy包，rospy是ROS的python客户端。<br>代码：from std_msgs.msg import String<br>分析：导入python的标准字符处理库，String是一个函数，可以另外方式赋值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msg = String()  </span><br><span class="line">msg.data = str</span><br></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String(data=str)</span><br></pre></td></tr></table></figure></p>
<p>代码：def talker()<br>分析：定义talker函数<br>代码：pub = rospy.Publisher(‘chatter’, String, queue_size=10)<br>分析：定义发布的主题名称chatter， 消息类型String,实质是std_msgs.msg.String<br>代码：rospy.init_node(‘talker’, anonymous=True)<br>分析：初始化节点，节点名称为talker, anonymous=True，要求每个节点都有唯一的名称，避免冲突。这样可以运行多个talker.py<br>代码：rate = rospy.Rate(10) # 10hz<br>分析：设置发布的频率，单位是每秒次数，这是每秒10次的频率发布主题<br>代码：rospy.is_shutdown()<br>分析：用于检测程序是否退出，是否按Ctrl-C 或其他<br>代码：rospy.loginfo<br>分析：在屏幕输出日志信息，写入到rosout节点，也可以通过rqt_console来查看。<br>代码：pub.publish(hello_str)<br>分析：发布信息到主题<br>代码：rate.sleep()<br>分析：睡眠一定持续时间，如果参数为负数，睡眠会立即返回。</p>
<p>5.编译代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/catkin_ws</span><br><span class="line">$ catkin_make</span><br></pre></td></tr></table></figure></p>
<p>6.测试代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ roscore</span><br><span class="line">$ rosrun beginner_tutorials talker.py</span><br></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubu@ubu:~/catkin_ws/src$ rosrun beginner_tutorials talker.py </span><br><span class="line">[INFO] [WallTime: 1478418967.640556] hello world 1478418967.64</span><br><span class="line">[INFO] [WallTime: 1478418967.741493] hello world 1478418967.74</span><br></pre></td></tr></table></figure></p>
<p>7.查看主题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rostopic echo /chatter</span><br></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data: hello world 1478444433.95</span><br><span class="line">---</span><br><span class="line">data: hello world 1478444434.45</span><br><span class="line">---</span><br><span class="line">data: hello world 1478444434.95</span><br><span class="line">---</span><br><span class="line">data: hello world 1478444435.45</span><br><span class="line">---</span><br><span class="line">data: hello world 1478444435.95</span><br><span class="line">---</span><br><span class="line">data: hello world 1478444436.45</span><br></pre></td></tr></table></figure></p>
<p>三、编写订阅器<br>1.进入~/catkin_ws/src/beginner_tutorials/scripts目录，建立listener.py文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ roscd beginner_tutorials </span><br><span class="line">$ cd scripts</span><br><span class="line">$ touch listener.py</span><br><span class="line">$ chmod +x listener.py</span><br><span class="line">$ rosed beginner_tutorials  listener.py</span><br></pre></td></tr></table></figure></p>
<p>2.输入代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import rospy</span><br><span class="line">from std_msgs.msg import String</span><br><span class="line"></span><br><span class="line">def callback(data):</span><br><span class="line">    rospy.loginfo(rospy.get_caller_id() + &apos;I heard %s&apos;, data.data)</span><br><span class="line"></span><br><span class="line">def listener():</span><br><span class="line"></span><br><span class="line">    # In ROS, nodes are uniquely named. If two nodes with the same</span><br><span class="line">    # name are launched, the previous one is kicked off. The</span><br><span class="line">    # anonymous=True flag means that rospy will choose a unique</span><br><span class="line">    # name for our &apos;listener&apos; node so that multiple listeners can</span><br><span class="line">    # run simultaneously.</span><br><span class="line">    rospy.init_node(&apos;listener&apos;, anonymous=True)</span><br><span class="line"></span><br><span class="line">    rospy.Subscriber(&apos;chatter&apos;, String, callback)</span><br><span class="line"></span><br><span class="line">    # spin() simply keeps python from exiting until this node is stopped</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    listener()</span><br></pre></td></tr></table></figure></p>
<p>3.代码解析<br>代码：rospy.init_node(‘listener’, anonymous=True)<br>分析：初始化节点，节点名称为talker, anonymous=True，要求每个节点都有唯一的名称，避免冲突。这样可以运行多个listener.py<br>代码： rospy.Subscriber(“chatter”, String, callback)<br>分析：订阅函数，订阅chatter主题，内容类型是std_msgs.msgs.String。当有新内容，调用callback函数处理。接受到的主题内容作为参数传递给callback.<br>代码：rospy.spin()<br>分析：保持节点运行，直到节点关闭。不像roscpp,rospy.spin不影响订阅的回调函数，因为回调函数有自己的线程。</p>
<p>4.编译代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/catkin_ws</span><br><span class="line">$ catkin_make</span><br></pre></td></tr></table></figure></p>
<p>5.测试代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ roscore </span><br><span class="line">$ rosrun beginner_tutorials listener.py</span><br></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubu@ubu:~/catkin_ws/src/beginner_tutorials/scripts$ rosrun beginner_tutoals listener.py </span><br><span class="line">[INFO] [WallTime: 1478442694.947875] /listerner_14737_1478442694294I heard hello world 1478442694.95</span><br><span class="line">[INFO] [WallTime: 1478442695.448907] /listerner_14737_1478442694294I heard hello world 1478442695.45</span><br></pre></td></tr></table></figure></p>
<p>6.也可以使用命令测试listener.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rostopic pub -r 10 /chatter std_msgs/String &quot;test&quot;</span><br></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ rostopic echo /chatter</span><br><span class="line"></span><br><span class="line">data: test</span><br><span class="line">---</span><br><span class="line">data: test</span><br><span class="line">---</span><br><span class="line">data: test</span><br><span class="line">---</span><br><span class="line">data: test</span><br><span class="line">---</span><br><span class="line">data: test</span><br><span class="line">---</span><br><span class="line">data: test</span><br></pre></td></tr></table></figure></p>
<p>四、制作launch文件<br>1.在beginner_tutorials目录下新建bringup目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ roscd beginner_tutorials</span><br><span class="line">$ mkdir -p bringup</span><br></pre></td></tr></table></figure></p>
<p>2.进入bringup, 新建talker-and-listener.launch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd bringup</span><br><span class="line">$ rosed beginner_tutorials talker-and-listener.launch</span><br></pre></td></tr></table></figure></p>
<p>3.输入代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node name=&quot;talker&quot; pkg=&quot;beginner_tutorials&quot; type=&quot;talker.py&quot; /&gt;</span><br><span class="line">    &lt;node name=&quot;listener&quot; pkg=&quot;beginner_tutorials&quot; type=&quot;listener.py&quot; /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></p>
<p>4.运行launch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ roslaunch beginner_tutorials talker-and-listener.launch</span><br></pre></td></tr></table></figure></p>
<p>输出就可以看到节点里有talker和listener</p>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2019 <a href="/" rel="nofollow">YuemingBi</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>